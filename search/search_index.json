{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Homelab Playbooks","text":"<p>Ansible playbooks repo for my homelab.</p>"},{"location":"#tldr","title":"TL;DR","text":"<ul> <li>Install dependencies: <code>task deps</code></li> <li>Generate a new vault password: <code>task init</code></li> <li>Edit secrets: <code>task ve</code></li> <li> <ul> <li>Edit role variables: <code>ansible-vault edit roles/&lt;role&gt;/vars/main.yaml</code></li> </ul> </li> <li>Update all hosts: <code>ansible-playbook playbooks/update_all.yaml</code></li> <li>See all available tasks: <code>task -l</code></li> </ul>"},{"location":"#background","title":"Background","text":"<p>This repository contains Ansible playbooks used to configure and manage my homelab environment. The playbooks are designed to be idempotent and are used to set up and maintain various services and configurations across different types of machines, including Ubuntu servers, Raspberry Pis, Proxmox VE nodes, LXC containers, and Docker hosts.</p>"},{"location":"#prerequisites","title":"Prerequisites","text":"<ul> <li>Ansible</li> <li>Python</li> <li>Task</li> </ul> <p>Note</p> <p>Please ensure that <code>python3</code> is installed on the hosts you want to manage. For more details, see the Getting Started guide.</p>"},{"location":"#installation","title":"Installation","text":"<p>To get started, clone the repository and install the dependencies:</p> <pre><code>git clone https://github.com/nicholaswilde/homelab-playbooks.git\ncd homelab-playbooks\ntask deps\n</code></pre> <p>For more detailed instructions, see the Getting Started guide.</p>"},{"location":"#development","title":"Development","text":"<p>This project uses Task for command running and MkDocs for documentation.</p> <p>For more information on development, see the Development guide.</p>"},{"location":"#license","title":"License","text":"<p>\u200b\u200bApache License 2.0</p>"},{"location":"#author","title":"\u200bAuthor","text":"<p>\u200bThis project was started in 2025 by \u200bNicholas Wilde\u200b.</p>"},{"location":"#references","title":"References","text":""},{"location":"configuration/","title":"Configuration","text":""},{"location":"configuration/#dynamic-proxmox-inventory","title":"Dynamic Proxmox Inventory","text":"<p>This project uses dynamic inventory for Proxmox VE. The inventory files <code>inventory/amd64.proxmox.yaml</code> and <code>inventory/arm64.proxmox.yaml</code> use the <code>community.proxmox.proxmox</code> plugin to connect to a Proxmox VE instance and retrieve information about LXC containers. This allows for dynamic discovery of hosts based on your Proxmox setup.</p>"},{"location":"configuration/#creating-a-proxmox-api-token","title":"Creating a Proxmox API Token","text":"<p>To use the dynamic inventory, you need to create a Proxmox API token. Here's how to do it:</p> <ol> <li>Log in to the Proxmox web interface.</li> <li>Navigate to <code>Datacenter</code> -&gt; <code>Permissions</code> -&gt; <code>API Tokens</code>.</li> <li>Click <code>Add</code> to create a new API token.</li> <li>Select the user you want to create the token for (e.g., <code>root@pam</code>).</li> <li>Provide a <code>Token ID</code> (e.g., <code>ansible</code>).</li> <li>Uncheck the <code>Privilege Separation</code> checkbox. This is important for the dynamic inventory to work correctly.</li> <li>Click <code>Add</code>.</li> <li>Copy the <code>Token ID</code> and <code>Secret</code>. You will need these for your Ansible configuration. The secret will not be shown again, so make sure to save it in a secure location.</li> </ol> <p>Security Recommendation</p> <p>For enhanced security, it is recommended to create a dedicated, non-root user for Ansible and to generate the API token under that user. This user should be granted only the minimum necessary permissions for Ansible to manage your Proxmox resources.</p>"},{"location":"configuration/#options","title":"Options","text":"<p>The following options can be configured in <code>inventory/amd64.proxmox.yaml</code> and <code>inventory/arm64.proxmox.yaml</code>:</p> <ul> <li><code>plugin</code>: The Ansible plugin to use. This should be set to <code>community.proxmox.proxmox</code>.</li> <li><code>url</code>: The URL of your Proxmox VE instance.</li> <li><code>validate_certs</code>: Whether to validate the SSL certificate of the Proxmox server. Defaults to <code>false</code>.</li> <li><code>want_facts</code>: Whether to retrieve facts about the Proxmox nodes. Defaults to <code>true</code>.</li> <li><code>user</code>: The Proxmox user to connect with.</li> <li><code>token_id</code>: The ID of the Proxmox API token.</li> <li><code>token_secret</code>: The secret of the Proxmox API token. This should be encrypted with Ansible Vault, see the Secrets guide.</li> </ul>"},{"location":"configuration/#example","title":"Example","text":"<pre><code>---\nplugin: community.proxmox.proxmox\nurl: https://pve01.l.nicholaswilde.io\nvalidate_certs: false\nwant_facts: true\n\n# Proxmox credentials. Create a token on the Proxmox node.\nuser: root@pam\ntoken_id: ansible\n\n# password file .vault_pass\ntoken_secret: !vault |\n          $ANSIBLE_VAULT;1.1;AES256\n          63356539313533663964636139333037386262616239373638333136643834303631653139633437\n          6562613738653338613134343635383639363237343833390a353364373034383664343661316339\n          64333066646635396134323334336164633965373830666665353431326338363131386530383631\n          3939643133346134300a393136636137326431303965353537386665323766313464666331333337\n          62326331663361376632393331396439383666333739323766316432393761666561356266643938\n          3165353364633639326632336539313466343531363431373465\n\ncompose:\n  ansible_host: proxmox_agent_interfaces[1]['ip-addresses'][0] | default(proxmox_net0.ip) | ansible.utils.ipaddr('address')\n  ansible_user: \"'root'\"\n</code></pre> <p><code>ansible_user</code> Quoting</p> <p>The <code>ansible_user</code> value needs to be in single quotes inside of double quotes (e.g., <code>\"'root'\"</code>). This specific quoting is necessary due to the multi-layered parsing involved:</p> <ol> <li>YAML Parsing: The outer double quotes (<code>\"...\"</code>) instruct the YAML parser to treat the entire content (<code>'root'</code>) as a single string.</li> <li>Jinja2 Evaluation: Ansible's <code>compose</code> feature then evaluates this string using the Jinja2 templating engine. The inner single quotes (<code>'...'</code>) ensure that the final output of this Jinja2 evaluation is a literal string <code>'root'</code>, which is what the underlying system expects for the <code>ansible_user</code> variable.</li> </ol> <p>The <code>ansible_user</code> variable in the <code>compose</code> section sets the default SSH user for all discovered Proxmox LXC containers. In the example above, it is set to <code>'root'</code> for all containers.</p>"},{"location":"configuration/#conditionally-setting-ansible_user","title":"Conditionally Setting <code>ansible_user</code>","text":"<p>You can conditionally set the <code>ansible_user</code> for specific hosts within the dynamic inventory by using a Jinja2 expression in the <code>compose</code> section. This is useful when most hosts use a default user (like <code>root</code>), but a few require a different user.</p> <p>The <code>name</code> variable, which corresponds to the Proxmox guest's name, can be used in the conditional.</p> <p>For example, to use the <code>nicholas</code> user for the host named <code>arm64</code> and <code>root</code> for all other hosts discovered by this inventory source, you can set <code>ansible_user</code> as follows:</p> <pre><code>compose:\n  ansible_host: proxmox_agent_interfaces[1]['ip-addresses'][0] | default(proxmox_net0.ip) | ansible.utils.ipaddr('address')\n  ansible_user: \"'nicholas' if name == 'arm64' else 'root'\"\n</code></pre> <p>This approach keeps the user configuration within the dynamic inventory file, avoiding the need for separate static inventory files for overrides.</p>"},{"location":"configuration/#raspberry-pi-hosts","title":"Raspberry Pi Hosts","text":"<p>I have multiple Raspberry Pis on my network that are not part my dynamic inventory. They are managed using a static inventory file and specific playbooks.</p>"},{"location":"configuration/#inventory","title":"Inventory","text":"<p>The inventory for the Raspberry Pi hosts is defined in <code>inventory/rpis.yaml</code>. This is a static inventory file that lists the hosts and their connection information.</p> <p>inventory/rpis.yaml</p> <pre><code>---\nrpis:\n  vars:\n    user: nicholas\n    ansible_user: nicholas\n  hosts:\n    pi00:\n      ansible_host: 192.168.3.219\n    pi01:\n      ansible_host: 192.168.3.229\n    pi02:\n      ansible_host: 192.168.3.250\n    pi04:\n      ansible_host: 192.168.2.88\n</code></pre>"},{"location":"configuration/#playbooks","title":"Playbooks","text":"<p>There are several playbooks available for managing the Raspberry Pi hosts:</p> <ul> <li> <p>Update All Raspberry Pis: The <code>playbooks/update_rpis.yaml</code> playbook updates all Raspberry Pi hosts. It uses the <code>update_apt</code> and <code>update_git</code> roles.</p> <p>To run this playbook:</p> <pre><code>ansible-playbook playbooks/update_rpis.yaml\n</code></pre> </li> <li> <p>Run a Single Task: The <code>playbooks/task_rpis.yaml</code> playbook runs a single task on all Raspberry Pi hosts. It uses the <code>single</code> role.</p> <p>To run this playbook:</p> <pre><code>ansible-playbook playbooks/task_rpis.yaml\n</code></pre> </li> </ul>"},{"location":"configuration/#openmediavault-host","title":"OpenMediaVault Host","text":"<p>I have an OpenMediaVault (OMV) instance running as a VM on my Proxmox host. It is managed as a single host.</p>"},{"location":"configuration/#playbooks_1","title":"Playbooks","text":"<ul> <li> <p>Update OMV: The <code>playbooks/update_omv.yaml</code> playbook updates the OMV host. It runs the <code>omv-update</code> command.</p> <p>To run this playbook:</p> <pre><code>ansible-playbook playbooks/update_omv.yaml\n</code></pre> <p>Note</p> <p>The <code>omv-update</code> command is a wrapper script that is the recommended way to update OpenMediaVault. It is a non-interactive script that runs <code>apt update</code> and <code>apt upgrade</code> and also handles other OMV-specific configurations and checks to ensure the system remains stable.</p> </li> </ul>"},{"location":"configuration/#homelab-pull","title":"Homelab-Pull","text":""},{"location":"configuration/#playbooks_2","title":"Playbooks","text":"<ul> <li> <p>Remove homelab-pull: The <code>playbooks/remove_homelab_pull.yaml</code> playbook removes the <code>homelab-pull</code> service and timer from all hosts.</p> <p>To run this playbook:</p> <pre><code>ansible-playbook playbooks/remove_homelab_pull.yaml\n</code></pre> </li> </ul>"},{"location":"configuration/#role-configuration-variables","title":"Role Configuration Variables","text":"<p>Variables for individual roles are stored in the <code>roles/&lt;role name&gt;/defaults/main.yaml</code></p> <p>Example</p> <pre><code>---\nsetup_git_email: \"ncwilde43@gmail.com\"\nsetup_git_signing_key: \"69FF3D02ABFCD01F328778D5374FA199233281E4\"\nsetup_git_repo: \"git@github.com:nicholaswilde/homelab.git\"\nsetup_git_homelab_folder: \"git/nicholaswilde/homelab\"\n\nsetup_nfs_path: \"storage -fstype=nfs4,rw 192.168.2.19:/storage\"\n\n# setup_proxy: \"http://192.168.2.40:3142\"\nsetup_proxy: \"http://aptcache.l.nicholaswilde.io:3142\"\n\nsetup_beszel_key: \"\"\n\nsetup_dotfiles_repo: \"https://github.com/nicholaswilde/dotfiles.git\"\nsetup_dotfiles_folder: \"git/nicholaswilde/dotfiles\"\n\n\nsetup_reprepro_base_url: \"http://deb.l.nicholaswilde.io\"\nsetup_reprepro_key_url: \"http://deb.l.nicholaswilde.io/public.gpg.key\"\n\nsetup_syncthing_port: '8384'\nsetup_syncthing_control_node_ip: \"192.168.2.28\"\nsetup_syncthing_control_node_label: \"amd2\"\n\nsetup_debug_enabled: false\n\nsetup_adguard_home_url: \"http://adguard01.l.nicholaswilde.io\"\n\nsetup_ssh_public_key_url: \"https://github.com/nicholaswilde.keys\"\n</code></pre>"},{"location":"configuration/#ansible-configuration-file","title":"Ansible Configuration File","text":"<p>The <code>ansible.cfg</code> file contains default settings for Ansible. Here are the key configurations used in this project:</p> <pre><code>[defaults]\ninventory = ./inventory/\nplaybook = ./playbooks/update_all.yaml \ntimeout = 25\nvault_password_file = ./.vault_pass\ninterpreter_python = auto_silent\nroles_path = ./roles/\nhost_key_checking = False\nprivate_key_file = /home/nicholas/.ssh/id_ed25519\n\n[ssh_connection]\nscp_if_ssh = True\n</code></pre>"},{"location":"configuration/#explanation-of-key-settings","title":"Explanation of Key Settings","text":"<ul> <li><code>inventory</code>: Specifies the default inventory directory.</li> <li><code>playbook</code>: Sets a default playbook to run if none is specified (e.g., <code>update_lxc.yaml</code>).</li> <li><code>timeout</code>: Sets the default SSH connection timeout to 25 seconds.</li> <li><code>vault_password_file</code>: Points to the <code>.vault_pass</code> file for Ansible Vault passwords.</li> <li><code>interpreter_python</code>: Automatically detects the Python interpreter on remote hosts.</li> <li><code>roles_path</code>: Specifies the directory where Ansible roles are located.</li> <li><code>host_key_checking</code>: Disables host key checking for SSH connections (use with caution in production environments).</li> <li><code>private_key_file</code>: Specifies the default private key file for SSH connections.</li> <li><code>scp_if_ssh</code>: Forces Ansible to use <code>scp</code> for file transfers over SSH, even if <code>sftp</code> is available. ```</li> </ul>"},{"location":"development/","title":"Development","text":"<p>This project uses Task as a command runner. The <code>Taskfile.yaml</code> at the root of the project contains all the available commands.</p>"},{"location":"development/#documentation","title":"Documentation","text":"<p>The documentation is built using MkDocs with the Material for MkDocs theme.</p>"},{"location":"development/#dependencies","title":"Dependencies","text":"<p>To install the documentation dependencies, run the following command:</p> TaskManual <pre><code>task docs-deps\n</code></pre> <pre><code>pipx install mkdocs\npipx install mkdocs-material\npipx install pymdown-extensions\n</code></pre>"},{"location":"development/#local-development-server","title":"Local Development Server","text":"<p>To start a local development server that automatically reloads when you make changes, run:</p> TaskManual <pre><code>task serve\n</code></pre> <pre><code> docker run --rm -it -p 8000:8000 -v ${PWD}:/docs \\\n    --platform linux/amd64 nicholaswilde/mkdocs-material serve \\\n    --dev-addr 0.0.0.0:8000 -f ./mkdocs.yml\n</code></pre> <p>This will make the documentation available at <code>http://localhost:8000</code>.</p>"},{"location":"development/#deployment","title":"Deployment","text":"<p>To deploy the documentation to GitHub Pages, run:</p> TaskManual <pre><code>task docs-deploy\n</code></pre> <pre><code>mkdocs gh-deploy --force\n</code></pre>"},{"location":"getting-started/","title":"Getting Started","text":""},{"location":"getting-started/#prerequisites","title":"Prerequisites","text":"<p>Before you can use Ansible to manage your hosts, you need to ensure that Python 3 is installed on them. For Debian-based systems, you can install it with the following command:</p> <pre><code>sudo apt update &amp;&amp; sudo apt install -y python3\n</code></pre>"},{"location":"getting-started/#install-dependencies","title":"Install dependencies","text":"<p>This project uses Task to manage dependencies. To install all the necessary dependencies, run the following command:</p> TaskManual <pre><code>task deps\n</code></pre> <pre><code>sudo apt install -y pipx\npipx install --include-deps ansible\npipx inject ansible ansible-lint\nansible-galaxy role install -r requirements.yaml\nansible-galaxy collection install -r requirements.yaml\n</code></pre> <p>This command will:</p> <ul> <li>Install <code>pipx</code> and ensure its paths are configured.</li> <li>Upgrade all <code>pipx</code> managed packages.</li> <li>Install Ansible roles from <code>requirements.yaml</code>.</li> <li>Install Ansible collections from <code>requirements.yaml</code>.</li> </ul>"},{"location":"getting-started/#generate-a-new-password","title":"Generate a new password","text":"<p>To create a new vault password file, use the <code>task init</code> command:</p> TaskManual <pre><code>task init\n</code></pre> <pre><code>openssl rand -hex 64 &gt; .vault_pass\nchmod 600 .vault_pass    \n</code></pre> <p>This will create a <code>.vault_pass</code> file in the root directory. This file should be kept secret and is used to encrypt/decrypt sensitive variables. The <code>.vault_pass</code> file is encrypted using SOPS.</p>"},{"location":"getting-started/#edit-secrets","title":"Edit secrets","text":"<p>To edit the secrets file, use the following command:</p> TaskManual <pre><code>task ve\n</code></pre> <pre><code>ansible-vault edit ./inventory/group_vars/all.yaml\n</code></pre> <p>This will open the <code>inventory/group_vars/all.yaml</code> file in your default editor. This file is encrypted with Ansible Vault.</p> <p>For more information on managing secrets, see the Secrets guide.</p>"},{"location":"secrets/","title":"Secrets","text":"<p>Secret variables are encrypted using Ansible Vault as a string or the entire file is encrypted. My preference is to encrypt files or strings using a vault password file.</p>"},{"location":"secrets/#config","title":"Config","text":"<p>Set the <code>vault_password_file</code> variable in the <code>ansible.cfg</code> so you don't need to specify the file, <code>--vault-password-file</code>, with every command.</p> <p>ansible.cfg</p> <pre><code>[defaults]\nvault_password_file = ./.vault_pass\n</code></pre>"},{"location":"secrets/#vault-password-file","title":"Vault Password File","text":"<p>To create a new vault password file, use the <code>task init</code> command:</p> <p>Warning</p> <p>Ensure that you're not overwriting an existing password!</p> TaskManual <pre><code>task init\n</code></pre> <pre><code>openssl rand -hex 64 &gt; .vault_pass\nchmod 600 .vault_pass\n</code></pre> <p>Tip</p> <p>It is recommended save the password elsewhere as a backup. </p> <p>This will create a <code>.vault_pass</code> file in the root directory. This file should be kept secret and is used to encrypt/decrypt sensitive variables. The <code>.vault_pass</code> file is encrypted using SOPS.</p> <p>To encrypt the <code>.vault_pass</code> file for later use:</p> TaskManual <pre><code>task encrypt\n</code></pre> <pre><code>sops -e .vault_pass &gt; .vault_pass.enc\n</code></pre> <p>To decrypt the <code>.vault_pass.enc</code> file:</p> TaskManual <pre><code>task decrypt\n</code></pre> <pre><code>sops -d .vault_pass.enc &gt; .vault_pass\nchmod 600 .vault_pass\n</code></pre>"},{"location":"secrets/#string","title":"String","text":"<p>Encrypt a secret variable as a string to use in a playbook.</p> Manual <pre><code>ansible-vault encrypt_string \"long-token-secret\" --name \"token_secret\"\n</code></pre> <p>Copy the output to a playbook to use the variable.</p> <p>Output</p> <pre><code># password file .vault_pass\ntoken_secret: !vault |\n          $ANSIBLE_VAULT;1.1;AES256\n          63356539313533663964636139333037386262616239373638333136643834303631653139633437\n          6562613738653338613134343635383639363237343833390a353364373034383664343661316339\n          64333066646635396134323334336164633965373830666665353431326338363131386530383631\n          3939643133346134300a393136636137326431303965353537386665323766313464666331333337\n          62326331663361376632393331396439383666333739323766316432393761666561356266643938\n          3165353364633639326632336539313466343531363431373465\n</code></pre>"},{"location":"secrets/#file","title":"File","text":"<p>Encrypt the secrets file using Ansible Vault.</p> Manual <pre><code>ansible-vault encrypt \"./inventory/group_vars/all.yaml\"\n</code></pre> <p>Edit the secrets file.</p> TaskManual <pre><code>task ve\n</code></pre> <pre><code>ansible-vault edit \"./inventory/group_vars/all.yaml\"\n</code></pre>"},{"location":"secrets/#references","title":"References","text":"<ul> <li>https://docs.ansible.com/ansible/latest/vault_guide/index.html</li> </ul>"},{"location":"testing/","title":"Testing","text":"<p>This project includes several tasks for testing the Ansible playbooks against different architectures.</p>"},{"location":"testing/#amd64","title":"AMD64","text":"<p>To test the playbooks on amd64 hosts, run the following command:</p> TaskManual <pre><code>task amd64-test\n</code></pre> <pre><code>ansible proxmox_all_lxc -i inventory/amd64.proxmox.yaml -m ansible.builtin.apt -a \"update_cache=true\" -b\n</code></pre> <p>This task will run the <code>ansible.builtin.apt</code> module with <code>update_cache=true</code> on all hosts in the <code>inventory/amd64.proxmox.yaml</code> inventory.</p>"},{"location":"testing/#arm64","title":"ARM64","text":"<p>To test the playbooks on arm64 hosts, run the following command:</p> TaskManual <pre><code>task arm64-test\n</code></pre> <pre><code>ansible proxmox_all_lxc -i inventory/arm64.proxmox.yaml -m ansible.builtin.apt -a \"update_cache=true\" -b\n</code></pre> <p>This task will run the <code>ansible.builtin.apt</code> module with <code>update_cache=true</code> on all hosts in the <code>inventory/arm64.proxmox.yaml</code> inventory.</p>"},{"location":"testing/#raspberry-pi","title":"Raspberry Pi","text":"<p>To test the playbooks on Raspberry Pi hosts, run the following command:</p> TaskManual <pre><code>task rpis-test\n</code></pre> <pre><code>ansible rpis -i inventory/rpis.yaml -m ansible.builtin.apt -a \"update_cache=true\" -b\n</code></pre> <p>This task will run the <code>ansible.builtin.apt</code> module with <code>update_cache=true</code> on all hosts in the <code>inventory/rpis.yaml</code> inventory.</p>"},{"location":"testing/#dockerized-testing-environment","title":"Dockerized Testing Environment","text":"<p>This project includes a Dockerized testing environment in the <code>test/</code> subdirectory, which allows you to test Ansible playbooks in an isolated Ubuntu container.</p>"},{"location":"testing/#configuration","title":"Configuration","text":"<ul> <li><code>test/Dockerfile</code>: Defines the Docker image used for testing. It sets up an Ubuntu container with SSH access.</li> <li><code>test/machine-setup.yml</code>: The Ansible playbook that will be run inside the test container. You can modify this file to test your own playbooks and roles.</li> </ul>"},{"location":"testing/#usage","title":"Usage","text":"<p>To run the Dockerized test, navigate to the <code>test/</code> directory and use the <code>task run</code> command:</p> TaskManual <pre><code>cd test/\ntask run\n</code></pre> <pre><code>cd test/\n./setup-container.sh\n</code></pre> <p>This will execute the <code>setup-container.sh</code> script, which automates the entire testing process:</p> <ol> <li>Creates a temporary directory.</li> <li>Generates a temporary SSH key.</li> <li>Builds and starts a Docker container.</li> <li>Creates a temporary Ansible inventory file.</li> <li>Runs the <code>machine-setup.yml</code> playbook inside the container.</li> <li>Cleans up the container and temporary files.</li> </ol>"},{"location":"troubleshooting/","title":"Troubleshooting","text":""},{"location":"troubleshooting/#ssh-connection-issues","title":"SSH Connection Issues","text":"<p>If you are experiencing issues connecting to your hosts via SSH, your <code>~/.ssh/config</code> file might be causing problems.</p> <p>Ansible uses the SSH client to connect to remote hosts. If your <code>~/.ssh/config</code> file contains incorrect configurations, such as wrong hostnames, invalid identities, or conflicting options, it can prevent Ansible from establishing a successful SSH connection.</p>"},{"location":"troubleshooting/#diagnosis","title":"Diagnosis","text":"<p>To diagnose SSH connection issues, you can try the following:</p> <ol> <li> <p>Test SSH connection manually:</p> <pre><code>ssh -vvv your_host_alias\n</code></pre> <p>The <code>-vvv</code> option provides verbose output, which can help identify where the connection is failing.</p> </li> <li> <p>Check <code>~/.ssh/config</code> for conflicts:</p> <p>Review your <code>~/.ssh/config</code> file for any entries that might be overriding Ansible's connection parameters or causing unexpected behavior. Pay close attention to <code>Host</code>, <code>Hostname</code>, <code>User</code>, <code>IdentityFile</code>, and <code>ProxyCommand</code> directives.</p> </li> <li> <p>Temporarily disable <code>~/.ssh/config</code>:</p> <p>You can temporarily bypass your <code>~/.ssh/config</code> file by using the <code>-F /dev/null</code> option with the <code>ssh</code> command:</p> <pre><code>ssh -F /dev/null -vvv user@your_host_ip\n</code></pre> <p>If the connection works without the <code>config</code> file, the issue is definitely within your <code>~/.ssh/config</code>.</p> </li> </ol>"},{"location":"troubleshooting/#resolution","title":"Resolution","text":"<ul> <li>Correct or remove conflicting entries: Edit your <code>~/.ssh/config</code> file to fix any incorrect configurations or remove entries that are no longer needed.</li> <li> <p>Specify connection parameters in Ansible: You can explicitly define SSH connection parameters in your Ansible inventory or playbook to override any problematic settings in <code>~/.ssh/config</code>.</p> <p>Example in inventory:</p> <pre><code>[your_group]\nyour_host_alias ansible_host=your_host_ip ansible_user=your_user ansible_ssh_private_key_file=/path/to/your/key\n</code></pre> </li> </ul>"},{"location":"troubleshooting/#debugging-ansible-variables","title":"Debugging Ansible Variables","text":"<p>When troubleshooting Ansible playbooks, it's often helpful to inspect the values of variables that Ansible is using. The <code>task list</code> command can be used to display all inventory variables, which can help you verify if your variables are being set as expected.</p> <p>To list all inventory variables, run the following command:</p> TaskManaul <pre><code>task list\n</code></pre> <pre><code>ansible-inventory -i ./inventory/ --vars --list -y\n</code></pre> <p>This command will output a detailed YAML representation of your entire inventory, including all host and group variables, which can be invaluable for debugging.</p>"},{"location":"troubleshooting/#references","title":"References","text":""},{"location":"usage/","title":"Usage","text":"<p>The primary way to use this project is by running Ansible playbooks. The <code>Taskfile.yaml</code> provides a set of convenient tasks for common operations.</p> <ul> <li>See all available tasks: <pre><code>task -l\n</code></pre></li> </ul>"},{"location":"usage/#general-tasks","title":"General Tasks","text":"<ul> <li><code>task bootstrap</code>: Bootstrap the environment by installing dependencies.</li> <li><code>task deps</code>: Install Ansible roles and collections from <code>requirements.yaml</code>.</li> <li><code>task update-deps</code>: Update Ansible, ansible-lint, and Ansible roles and collections from <code>requirements.yaml</code>.</li> <li><code>task setup</code>: Setup a single LXC using the <code>playbooks/setup_single.yaml</code> playbook.</li> <li><code>task update</code>: Update a single LXC using the <code>playbooks/update_single.yaml</code> playbook.</li> <li><code>task task_all</code>: Run a single task on all hosts.</li> <li><code>task task_lxcAll</code>: Run a single task on all LXC containers.</li> <li><code>task task_rpis</code>: Run a single task on all Raspberry Pis.</li> <li><code>task replace-apt-proxy</code>: Replace the apt proxy URL on all hosts.</li> </ul>"},{"location":"usage/#nas-omv-tasks","title":":nas: OMV Tasks","text":"<ul> <li><code>task omv-update</code>: Update the OpenMediaVault host.</li> </ul>"},{"location":"usage/#homelab-pull-tasks","title":"Homelab-Pull Tasks","text":"<ul> <li><code>task remove-homelab-pull</code>: Remove the homelab-pull service and timer from all hosts.</li> </ul>"},{"location":"usage/#inventory-tasks","title":"Inventory Tasks","text":"<ul> <li><code>task list</code>: List all inventory.</li> <li><code>task ping</code>: Ping all hosts in the inventory.</li> <li><code>task amd64-list</code>: List the amd64 Proxmox inventory.</li> <li><code>task arm64-list</code>: List the arm64 Proxmox inventory.</li> <li><code>task amd64-graph</code>: Graph the amd64 Proxmox inventory.</li> <li><code>task arm64-graph</code>: Graph the arm64 Proxmox inventory.</li> </ul>"},{"location":"usage/#testing-tasks","title":"Testing Tasks","text":"<ul> <li><code>task amd64-test</code>: Test amd64 hosts.</li> <li><code>task arm64-test</code>: Test arm64 hosts.</li> <li><code>task rpis-test</code>: Test Raspberry Pi hosts.</li> </ul>"},{"location":"usage/#vault-tasks","title":"Vault Tasks","text":"<ul> <li><code>task init</code>: Generate a new <code>.vault_pass</code> file.</li> <li><code>task decrypt</code>: Decrypt the <code>.vault_pass.enc</code> file.</li> <li><code>task encrypt</code>: Encrypt the <code>.vault_pass</code> file.</li> <li><code>task ve</code>: Edit the Ansible vault.</li> </ul>"},{"location":"usage/#documentation-tasks","title":"Documentation Tasks","text":"<ul> <li><code>task docs-deps</code>: Install documentation dependencies.</li> <li><code>task serve</code>: Start a local development server for the documentation.</li> <li><code>task docs-deploy</code>: Deploy the documentation to GitHub Pages.</li> </ul>"},{"location":"usage/#gemini-tasks","title":"Gemini Tasks","text":"<ul> <li><code>task gpro</code>: Run Gemini with the <code>gemini-2.5-pro</code> model.</li> <li><code>task gflash</code>: Run Gemini with the <code>gemini-2.5-flash</code> model.</li> <li><code>task glite</code>: Run Gemini with the <code>gemini-2.5-lite</code> model.</li> </ul>"},{"location":"workflows/","title":"Workflows","text":"<p>This document outlines the common workflows for testing and setting up new hosts in this project.</p>"},{"location":"workflows/#testing-workflow","title":"Testing Workflow","text":"<p>This workflow describes the process for testing a new Ansible task before deploying it to all hosts.</p> <ol> <li> <p>Add a Test Host:</p> <p>Add the IP address of your test host to the <code>inventory/single.yaml</code> file under the <code>hosts</code> section.</p> <pre><code>--- \nsingle:\n  vars:\n    ansible_user: root\n  hosts:\n    test:\n      ansible_host: &lt;YOUR_TEST_HOST_IP&gt;\n</code></pre> </li> <li> <p>Create a Test Task:</p> <p>Create your test task in the <code>playbooks/test.yaml</code> file. This playbook is configured to run on the <code>single</code> host group.</p> </li> <li> <p>Run the Test Playbook:</p> <p>Execute the test playbook to apply the task to your test host:</p> <pre><code>ansible-playbook playbooks/test.yaml\n</code></pre> </li> <li> <p>Deploy to All Hosts:</p> <p>Once you have verified that the task works as expected, you can deploy it to all other hosts using one of the following playbooks:</p> <ul> <li><code>playbooks/task_all.yaml</code>: Deploys the task to all LXC containers and Raspberry Pis.</li> <li><code>playbooks/task_lxcAll.yaml</code>: Deploys the task to all LXC containers.</li> </ul> </li> <li> <p>Incorporate into <code>setup</code> Role:</p> <p>After successful deployment, incorporate the new task into the <code>roles/setup</code> role. This ensures that the task is included in the setup process for new single hosts.</p> </li> </ol>"},{"location":"workflows/#setting-up-a-single-host","title":"Setting up a Single Host","text":"<p>This workflow describes how to set up a new single host using the <code>setup</code> role. This role is designed to apply a generic Linux configuration to a new host.</p> <ol> <li> <p>Add the Host to Inventory:</p> <p>Add the new host to your Ansible inventory. You can either add it to an existing inventory file or create a new one.</p> <p>I prefer to add it to my <code>inventory</code></p> </li> <li> <p>Create a Playbook:</p> <p>Create a new playbook that targets the new host and includes the <code>setup</code> role.</p> <pre><code>--- \n- name: Setup a new single host\n  hosts: &lt;your_new_host&gt;\n  become: true\n\n  roles:\n    - role: setup\n</code></pre> </li> <li> <p>Run the Playbook:</p> <p>Execute the playbook to configure the new host:</p> <pre><code>ansible-playbook playbooks/setup_single.yaml\n</code></pre> </li> </ol>"}]}